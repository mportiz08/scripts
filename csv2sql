#!/usr/bin/env ruby
file = ARGV[0]
out = File.basename(file, '.csv')

STDOUT.print "enter dataset name: "
dataset = STDIN.gets.strip

STDOUT.print "enter table name: "
table = STDIN.gets.strip

csv = File.open(file).readlines
csv.shift

File.open(File.join('.', "#{dataset}-build-#{out}.sql"), 'w') do |sql|
  sql.write "-- this file was generated by Marcus Ortiz <mportiz@calpoly.edu> using his csv2sql script\n"
  csv.each do |row|
    unless row.strip.empty?
      vals = row.split(',')
      vals = vals.map {|str| str.gsub("' ", "'")}
      vals = vals.map {|str| str.gsub(" '", "'")}
      row = vals.map(&:strip).join(', ')
      sql.write "INSERT INTO #{table} VALUES(#{row.strip});\n"
    end
  end
end
